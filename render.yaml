services:
- type: web
  name: wishlist-platform
  env: node
  region: frankfurt  # Choose your preferred region
  plan: free
  buildCommand: |
    apt-get update
    apt-get install -y wget gnupg
    wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add -
    sh -c 'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list'
    apt-get update
    apt-get install -y google-chrome-stable fonts-ipafont-gothic fonts-wqy-zenhei fonts-thai-tlwg fonts-kacst fonts-freefont-ttf libxss1 ca-certificates curl
    npm install
  # Run migrations before starting the server
  startCommand: "npx playwright install chromium && npm start"
  healthCheckPath: "/"
  envVars:
  - key: NODE_ENV
    value: production
  - key: PORT
    value: 10000  # Render sets the port, but we can define a default
  - key: DATABASE_URL
    fromDatabase:
      name: wishlist-db
      property: connectionString

databases:
- name: wishlist-db
  region: frankfurt  # Must match the service region
  plan: free